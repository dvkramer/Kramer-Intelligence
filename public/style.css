/* public/style.css */

/* General Reset / Base Styles */
* {
    box-sizing: border-box;
}

html {
    height: 100%;
    height: -webkit-fill-available; /* Better height handling on mobile Safari */
}

body {
    font-family: 'Roboto', sans-serif;
    background-color: #121212; /* Dark background */
    color: #e0e0e0; /* Light text */
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column; /* Stack content vertically */
    height: 100vh; /* Full viewport height */
    height: -webkit-fill-available; /* iOS fix */
    overflow: hidden; /* Prevent body itself from scrolling */
}

/* Scrollable Main Content Area (Contains H1 + Chat History) */
#main-content-area {
    flex-grow: 1; /* Takes up available vertical space */
    overflow-y: auto; /* Enables vertical scrolling */
    position: relative; /* Context for potential absolutely positioned children */
    display: flex; /* Use flex for internal stacking */
    flex-direction: column; /* Stack H1 above chat container */
}


/* Header Styling (Inside scrollable area) */
h1 {
    text-align: center;
    color: #ffffff;
    background-color: #1f1f1f; /* Slightly lighter dark bg */
    padding: 15px 20px;
    margin: 0; /* Remove default margin */
    font-weight: 500; /* Medium weight */
    border-bottom: 1px solid #333; /* Separator line */
    /* This element will scroll with the content */
}

/* Chat Container (Inside scrollable area) */
#chat-container {
    /* No flex-grow or overflow needed, handled by #main-content-area */
    padding: 20px; /* Spacing around chat history */
    width: 100%;
}

/* Chat History (Holds the message bubbles) */
#chat-history {
    display: flex;
    flex-direction: column; /* Stack messages vertically */
    gap: 15px; /* Space between messages */
    width: 100%;
    max-width: 800px; /* Limit content width */
    margin: 0 auto; /* Center the history horizontally */
    padding-bottom: 10px; /* Space at the very end of the scroll */
}

/* Individual Message Bubble Styling */
.message {
    padding: 10px 15px; /* Internal padding */
    border-radius: 18px; /* Rounded corners */
    max-width: 80%; /* Limit bubble width */
    line-height: 1.4; /* Text line spacing */
    overflow-wrap: break-word; /* Break long words/URLs */
    display: flex; /* Use flex for internal alignment if needed */
    flex-direction: column; /* Stack image/text/suggestions */
    gap: 8px; /* Space between stacked items */
}

/* Paragraphs within messages */
.message p {
    margin: 0; /* Remove default margins */
    overflow-wrap: break-word; /* Ensure wrapping */
}

/* User message specific styles */
.user-message {
    background-color: #007bff; /* Blue background */
    color: white;
    align-self: flex-end; /* Align to the right */
    border-bottom-right-radius: 5px; /* Slightly flattened corner */
}

/* Apply newline preservation to user message paragraphs */
.user-message p {
    white-space: pre-wrap; /* Preserve newlines and wrap text */
}

/* AI message specific styles */
.ai-message {
    background-color: #333333; /* Dark grey background */
    color: #e0e0e0;
    align-self: flex-start; /* Align to the left */
    border-bottom-left-radius: 5px; /* Slightly flattened corner */
}

/* Styling for Images within Messages */
.message img.message-image {
    max-width: 100%; /* Don't exceed bubble width */
    max-height: 300px; /* Limit image display height */
    border-radius: 10px; /* Rounded corners */
    object-fit: contain; /* Scale while preserving aspect ratio */
    cursor: pointer; /* Hint that it might be interactive */
    margin-top: 5px; /* Space above if text is also present */
}

/* --- Google Search Suggestion Styling (Minimal Wrapper Only) --- */
/* Container for Google's renderedContent */
.search-suggestion-container {
    margin-top: 12px; /* Space above the Google snippet */
    /* DO NOT add other styles (padding, bg, border, font, color) */
    /* Google's injected HTML/CSS must control the appearance */
}
/* --- End Search Suggestion Styling --- */

/* --- Markdown Element Styling --- */
/* Styling for code blocks */
.message pre {
    background-color: rgba(0, 0, 0, 0.2); /* Darker background for code */
    padding: 10px;
    border-radius: 4px;
    overflow-x: auto; /* Allow horizontal scrolling for long lines */
    border: 1px solid #444;
    margin-top: 8px;
    margin-bottom: 8px;
    white-space: pre; /* Preserve whitespace strictly */
}
/* Styling for inline and block code */
.message code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; /* Monospace font stack */
    font-size: 0.9em; /* Slightly smaller font */
}
/* Styling for inline code snippets within paragraphs */
.message p > code {
    background-color: rgba(255, 255, 255, 0.1); /* Subtle inline background */
    padding: 0.2em 0.4em;
    border-radius: 3px;
    font-size: 0.85em;
}
/* Reset background for code inside pre blocks */
.message pre code {
    background-color: transparent;
    padding: 0;
    font-size: inherit; /* Inherit size from pre */
    border-radius: 0;
}
/* Styling for lists */
.message ul, .message ol {
    padding-left: 25px; /* Indentation */
    margin-top: 8px;
    margin-bottom: 8px;
}
.message li {
    margin-bottom: 4px; /* Space between list items */
}
/* Styling for blockquotes */
.message blockquote {
    border-left: 3px solid #555; /* Left border */
    padding-left: 10px; /* Indentation */
    margin-left: 0;
    margin-top: 8px;
    margin-bottom: 8px;
    color: #bbb; /* Lighter text color */
    font-style: italic;
}
.message blockquote p {
    margin: 0; /* Reset paragraph margin inside blockquote */
}
/* Styling for links in regular markdown text */
.message p a {
    color: #64b5f6; /* Light blue link color */
    text-decoration: underline;
}
.message p a:hover {
    color: #90caf9; /* Lighter blue on hover */
}
/* Styling for headings */
.message h1, .message h2, .message h3, .message h4, .message h5, .message h6 {
    margin-top: 1em;
    margin-bottom: 0.5em;
    font-weight: 500; /* Medium weight */
    color: #ffffff; /* White headings */
}
.message h1 { font-size: 1.5em; }
.message h2 { font-size: 1.3em; }
.message h3 { font-size: 1.15em; }
.message h4 { font-size: 1em; }
.message h5 { font-size: 0.9em; }
.message h6 { font-size: 0.85em; color: #ccc; } /* Smaller, lighter H6 */
/* Styling for horizontal rules */
.message hr {
    border: 0;
    border-top: 1px solid #444;
    margin: 1em 0;
}
/* --- End Markdown Element Styling --- */


/* Loading / Error Indicators (Positioned below scroll area, above form) */
#loading, #error {
    text-align: center;
    padding: 10px;
    font-style: italic;
    color: #aaa; /* Grey italic text */
    width: 100%;
    max-width: 800px; /* Align with chat history width */
    margin: 5px auto; /* Centering and vertical space */
    flex-shrink: 0; /* Prevent shrinking */
}
/* Specific error styling */
#error {
    color: #ff4d4d; /* Red error text */
    font-weight: bold;
    background-color: rgba(255, 77, 77, 0.1); /* Faint red background */
    border-radius: 4px;
    border: 1px solid rgba(255, 77, 77, 0.3); /* Faint red border */
    padding: 10px 15px;
}


/* Image Preview Area Styling (Fixed below scroll area) */
#image-preview-container {
    background-color: #1f1f1f;
    /* Border handled conditionally with form below */
    padding: 8px 20px;
    display: flex; /* Used for centering internal div */
    justify-content: center;
    align-items: center;
    position: relative; /* For remove button positioning */
    flex-shrink: 0; /* Prevent shrinking */
    width: 100%;
}
/* Inner div for positioning remove button */
#image-preview-container > div {
    position: relative;
    display: inline-block; /* Allows centering via text-align on parent */
    max-width: 750px; /* Limit width */
    margin: 0 auto; /* Center */
    line-height: 0; /* Prevent extra space below image */
}
/* The preview image */
#image-preview {
    display: block;
    max-height: 80px; /* Limit preview height */
    max-width: 100%;
    border-radius: 6px;
    object-fit: contain;
    border: 1px solid #444;
}
/* The 'x' button to remove image */
#remove-image-button {
    position: absolute;
    top: -5px; /* Position overlap */
    right: -5px; /* Position overlap */
    width: 22px;
    height: 22px;
    background-color: rgba(40, 40, 40, 0.8); /* Semi-transparent dark */
    color: #ccc;
    border: 1px solid #555;
    border-radius: 50%; /* Circular */
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    line-height: 18px; /* Vertical center 'x' */
    text-align: center;
    padding: 0;
    transition: background-color 0.2s, color 0.2s; /* Smooth hover */
}
#remove-image-button:hover {
    background-color: rgba(255, 77, 77, 0.8); /* Reddish on hover */
    color: white;
    border-color: rgba(255, 77, 77, 0.9);
}


/* Input Form Styling (Fixed at the very bottom) */
#chat-form {
    display: flex;
    align-items: flex-end; /* Align items to bottom edge */
    padding: 15px 20px;
    /* Border handled conditionally below */
    background-color: #1f1f1f; /* Match header/preview background */
    flex-shrink: 0; /* Prevent shrinking */
    width: 100%;
    justify-content: center; /* Center items horizontally */
    gap: 10px; /* Space between attach, input, send */
}
/* Conditional border-top for form based on preview visibility */
#image-preview-container.hidden + #chat-form {
    border-top: 1px solid #333; /* Add border if preview is hidden */
}
#image-preview-container:not(.hidden) + #chat-form {
    border-top: none; /* Remove border if preview is visible (preview has border) */
}


/* Attach Button Styling */
#attach-button {
    background: none;
    border: none;
    color: #aaa; /* Default grey */
    font-size: 1.5rem; /* Icon size */
    cursor: pointer;
    padding: 0 5px; /* Minimal padding */
    line-height: 1; /* Align icon better */
    transition: color 0.2s; /* Smooth hover */
    flex-shrink: 0;
    align-self: flex-end; /* Align to bottom */
    margin-bottom: 10px; /* Fine-tune vertical alignment with textarea */
}
#attach-button:hover {
    color: #ddd; /* Lighter grey on hover */
}
/* Style when an image is attached */
#attach-button.has-file {
    color: #64b5f6; /* Blue when file selected */
}


/* Textarea Input Styling */
#message-input {
    /* Sizing & Box Model */
    flex-grow: 1; /* Take up available horizontal space */
    max-width: 700px; /* Limit width on large screens */
    padding: 10px 15px; /* Internal spacing */
    border: 1px solid #444;
    border-radius: 20px; /* Rounded corners */
    box-sizing: border-box; /* Include padding/border in element's total width/height */
    display: block; /* Needed for height adjustments */
    min-height: 42px; /* Set minimum height (approx 1 row + padding) */
    max-height: 25vh; /* Limit growth to 1/4 viewport height */
    /* Appearance */
    background-color: #2c2c2c; /* Dark input background */
    color: #e0e0e0; /* Light text */
    outline: none; /* Remove default focus outline */
    /* Font & Text */
    font-family: inherit; /* Use body font (Roboto) */
    font-size: 1rem; /* Standard font size */
    line-height: 1.4; /* Spacing for multi-line text */
    white-space: pre-wrap; /* Allow wrapping and preserve typed newlines */
    overflow-wrap: break-word; /* Break long words */
    /* Behavior */
    resize: none; /* Disable manual user resizing handle */
    overflow-y: auto; /* Show scrollbar only when max-height is reached */
}
/* Placeholder text style */
#message-input::placeholder {
    color: #888; /* Grey placeholder */
}
/* Focus style */
#message-input:focus {
    border-color: #4a90e2; /* Blue border on focus */
    box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.3); /* Subtle blue glow */
}

/* Send Button Styling */
#send-button {
    padding: 10px 20px;
    background-color: #007bff; /* Blue background */
    color: white;
    border: none;
    border-radius: 20px; /* Match input rounding */
    cursor: pointer;
    font-size: 1rem;
    transition: background-color 0.2s ease; /* Smooth hover */
    flex-shrink: 0; /* Prevent shrinking */
    align-self: flex-end; /* Align to bottom */
    margin-bottom: 8px; /* Fine-tune vertical alignment */
}
/* Disabled state */
#send-button:disabled {
    background-color: #004a9e; /* Darker blue */
    cursor: not-allowed;
    opacity: 0.7; /* Slightly faded */
}
/* Hover state (when not disabled) */
#send-button:hover:not(:disabled) {
    background-color: #0056b3; /* Darker blue on hover */
}


/* Utility class to hide elements */
.hidden {
    display: none !important; /* Force override display */
}


/* --- Responsive adjustments --- */
@media (max-width: 850px) {
     /* On medium screens, allow history/input to take more width */
     #chat-history { max-width: 95%; }
     #message-input { max-width: none; }
     #image-preview-container > div { max-width: 95%; }
     #chat-form { padding: 15px; gap: 8px;} /* Adjust form padding/gap */
}

@media (max-width: 600px) {
    /* On small screens, further reduce sizes/padding */
    h1 { font-size: 1.2rem; padding: 12px 15px; }
    #chat-container { padding: 10px; }
    #chat-history { gap: 12px; }
    .message { max-width: 90%; font-size: 0.95rem; padding: 8px 12px; }
    #chat-form { padding: 10px; gap: 5px; }
    #message-input { padding: 8px 12px; font-size: 0.95rem; min-height: 38px; }
    #send-button { padding: 8px 15px; font-size: 0.95rem; margin-bottom: 6px;}
    #attach-button { font-size: 1.3rem; padding: 0 3px; margin-bottom: 8px;}
    #loading, #error { max-width: 95%; font-size: 0.9rem; }
    #image-preview { max-height: 60px; }
    #remove-image-button { width: 20px; height: 20px; font-size: 14px; line-height: 18px; top: -4px; right: -4px;}
}